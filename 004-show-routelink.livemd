# Afficher des routelinks

```elixir
Mix.install([
  {:kino_maplibre, "~> 0.1.12"},
  {:unzip, "~> 0.12.0"}
])

Code.require_file(__DIR__ <> "/lib/zip_support.ex")
Code.require_file(__DIR__ <> "/lib/xml_support.ex")
Code.require_file(__DIR__ <> "/lib/helpers.ex")
:ok
```

## Section

```elixir
zip_file = __DIR__ <> "/data/ca_rochefort_ocean-aggregated-netex-2025-03-03.zip"

zip = ZipSupport.open_zip!(zip_file)

ligne_b_entry = ZipSupport.list_zip_entries(zip)
  |> Enum.filter(& &1 =~ ~r/RBUS_B_B/)
  |> Helpers.one!()

```

````elixir
content = ZipSupport.read_entry!(zip, ligne_b_entry) |> XmlSupport.string_to_xmerl!()

defmodule PosList do
  def extract_pos_list(string) do
    string
    |> Enum.split(~r/\s+/)
  end  
end

routelink = content |> XmlSupport.xpath!("//RouteLink") |> List.first()

xml_string = [routelink]
|> :xmerl.export_simple(:xmerl_xml) 
|> IO.iodata_to_binary()
|> String.replace("            ", "")
|> String.replace(~r/<\?xml.*\?>/, "")

Kino.Markdown.new("```xml\n#{xml_string}\n```")
|> Kino.render()

{:xmlObj, :string, data} = :xmerl_xpath.string(~c"string(gis:LineString/gis:posList/text())", routelink)

lat_lon = data
|> :erlang.list_to_binary()
|> String.split(~r/\s/)
|> Enum.map(&String.to_float(&1))
|> Enum.chunk_every(2)
|> Enum.map(fn([lat, lon]) -> %{"lat" => lat, "lon" => lon} end)
````

<!-- livebook:{"attrs":"eyJjZW50ZXIiOiItMC45NTEwMjUwMDkxNTUyNzM0LCA0NS45MjYxNzQxNjM4MTgzIiwibGF5ZXJzIjpbeyJhY3RpdmUiOnRydWUsImNsdXN0ZXJfY29sb3JzIjpbIiM1MWJiZDYiLCIjZjFmMDc1IiwiI2YyOGNiMSJdLCJjbHVzdGVyX21heCI6NzUwLCJjbHVzdGVyX21pbiI6MTAwLCJjb29yZGluYXRlc19mb3JtYXQiOiJjb2x1bW5zIiwibGF5ZXJfY29sb3IiOiIjZTYzYjdhIiwibGF5ZXJfb3BhY2l0eSI6MC42LCJsYXllcl9yYWRpdXMiOjksImxheWVyX3NvdXJjZSI6ImxhdF9sb24iLCJsYXllcl9zb3VyY2VfcXVlcnkiOm51bGwsImxheWVyX3NvdXJjZV9xdWVyeV9zdHJpY3QiOm51bGwsImxheWVyX3R5cGUiOiJjaXJjbGUiLCJzb3VyY2VfY29vcmRpbmF0ZXMiOm51bGwsInNvdXJjZV9sYXRpdHVkZSI6ImxhdCIsInNvdXJjZV9sb25naXR1ZGUiOiJsb24iLCJzb3VyY2VfdHlwZSI6InRhYmxlIn1dLCJtYXB0aWxlcl9rZXkiOm51bGwsIm1hcHRpbGVyX2tleV9zZWNyZXQiOm51bGwsIm1sX2FsaWFzIjoiRWxpeGlyLk1hcExpYnJlIiwic3R5bGUiOiJzdHJlZXQgKG5vbi1jb21tZXJjaWFsKSIsInVzZV9tYXB0aWxlcl9rZXlfc2VjcmV0Ijp0cnVlLCJ6b29tIjoxNH0","chunks":null,"kind":"Elixir.KinoMapLibre.MapCell","livebook_object":"smart_cell"} -->

```elixir
MapLibre.new(style: :street, center: {-0.9510250091552734, 45.9261741638183}, zoom: 14)
|> MapLibre.add_table_source("lat_lon", lat_lon, {:lng_lat, ["lon", "lat"]})
|> MapLibre.add_layer(
  id: "lat_lon_circle_1",
  source: "lat_lon",
  type: :circle,
  paint: [circle_color: "#e63b7a", circle_radius: 9, circle_opacity: 0.6]
)
```
